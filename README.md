# 3-D localization based on Magnetic field

This is my Master thesis, supervised by **Sizhen Bian**, at the group **Embedded Intelligence** of DFKI.

## Sensors & Devices 


| device | img |
| ---- | -------- |
| Transmitter | <div align=center><img src="./figure/transmitter.png" width=250></div> |
| Receiver (with IMU)| <div align=center><img src="./figure/IMU.png" width=250></div> |
| Ultra Sound| <div align=center><img src="./figure/Ultrasound.png" width=250></div> |



## Data
We collected data both **indoor*** and **outdoor**. The indoor data is at the second floor in DFKI Kaiserslautern, and collected outdoor data at the entrance of the DFKI.

## Approach
### 1.Preprocessing

* **Filtering out** the noise, picking up the peak mag point generated by each transmitter.
* **Interpolating** the ultrasound data, since these two sensors have different frequence, the data will be more smooth after interpolation.



### 2. Dead Reckoning
Dead Reckoning is a method to calculate the current position based on previously determined position. In our cases, given the **previous position** and **velocity**, we can take advantage the data from **IMU**, from which we can get **acceleration and eular angles** of each axis.

### 3. Model
Several models could be used in predicting the coordinates in 3D space, in this project, we tested both physical and machine-learning model  
 
* Physical model


| mag_1~dis_T1 | mag_2~dis_T2 | mag_3~dis_T3|
| ---- | -------- | ----|
| ![](./figure/1_reg.png)| ![](./figure/2_reg.png) | ![](./figure/3_reg.png)|



* Machine Learning model  
  - Random Forest
  - SVR  
  - KNN
  - SGD
  - MLP
  
  
### 4. Kalman Filter 
Kalman Filter is used to fuse the result from Dead Reckoning and the predictions from the model (physical or machine learning model). 
###  5.Data fusion
![](./figure/1.jpeg)

## Code

| file | description |
| ---- | -------- |
| [phy_model.py](./phy_model.py) | a physical model, predicting the position based distances to 3 transmitters |
| [ml_model.py](./ml_model.py)| using machine learning methods to predict the position|
| [dead_reckoning.py](dead_reckoning.py) |Integrating the IMU data by using Dead reckoning algorithem|   
| Kalman_filter.py| |
| performance.py | |
| [model](./model)| regression model and several ml models|

## Experiment Result
 
## Reference

* [Integrated WiFi/PDR/Smartphone Using an Unscented Kalman Filter Algorithm for 3D Indoor Localization](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4610469/)
* [A Robust Indoor Positioning System based on Encoded Magnetic Field and Low-cost IMU](https://ieeexplore.ieee.org/abstract/document/7479703)
